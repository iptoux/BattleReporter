(function(k,i,n,j,f,o,p){function g(e){e&&e.hover(function(){var b=$(this),a=d(b.attr("data-combatant-id"));b=b.find(".combatant-details");if(a){b.css("position","relative");j.attr("class","");a._team=="teamA"&&j.addClass("not-movable-left");a._team=="teamC"&&j.addClass("not-movable-right");a.brCombatantID<0||a.brManuallyAdded?j.addClass("not-hideable").addClass("not-showable"):j.addClass("not-trashable").addClass(a.brHidden?"not-hideable":"not-showable");if(a.died)j.addClass(a.brHidden?"not-showable":
"not-hideable");j.appendTo(b).show()}else console.log("no combatant found")},function(){j.hide()})}function d(e){if(typeof e=="undefined")return null;for(q=n.length;q--;)if((c=n[q]).brCombatantID==e)return c;return null}if(k){i=["teamA","teamB","teamC"];n=[];f={};o={};p=0;for(var m in k)if(i.indexOf(m)!=-1)for(var r=k[m],q=r.members.length,s;q--;){n.push(s=r.members[q]);s._team=m}j=$("#editor-panel").css({position:"absolute",bottom:0,right:0,width:"auto",height:"auto"});["move-left","move-right",
"show-on-br","hide-on-br","trash"].forEach(function(e){$("#editor-panel ."+e).click(function(b){b.preventDefault();b=$(this).closest(".combatant");var a=d(b.attr("data-combatant-id")),h,l;if(a)switch(e){case "move-left":h=k[a._team].members;l=i.indexOf(a._team);h.indexOf(a);h=i[(l==0?i.length:l)-1];k[a._team=h].members.push(a);b.appendTo($("#battlereport-"+h));f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].teamName=h;break;case "move-right":h=k[a._team].members;l=i.indexOf(a._team);
h.indexOf(a);h=i[(l+1==i.length?-1:l)+1];k[a._team=h].members.push(a);b.appendTo($("#battlereport-"+h));f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].teamName=h;break;case "hide-on-br":if(!a.died){a.brHidden=true;b.addClass("hidden-on-br");f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brHidden=true}break;case "show-on-br":a.brHidden=false;b.hasClass("hidden-on-br")&&b.removeClass("hidden-on-br");f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brHidden=false;
break;case "trash":a.brDeleted=true;b.detach();f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brDeleted=true}})});$("*[data-combatant-id]").each(function(){g($(this))});$(".combatant-corpname").autocomplete({serviceUrl:"/autocomplete/corpNames",type:"POST",onSelect:function(e){$(this).closest(".combatant-adding-form").find(".combatant-alliname").val(e.data)}});$(".combatant-alliname").autocomplete({serviceUrl:"/autocomplete/alliNames",type:"POST"});$(".combatant-shipname").autocomplete({serviceUrl:"/autocomplete/shipNames",
type:"POST",transformResult:function(e){var b=[];if(e&&(e=$.parseJSON(e)))b=$.map(e.ships,function(a){if(!(a.name in o))o[a.name]=a.id;return{value:a.name,data:a.id}});return{suggestions:b}}});$(".combatant-adding-form").submit(function(e){e.preventDefault();var b=$(this).closest(".combatant-adding-panel");e=b.closest("table").attr("id").replace(/^battlereport-/,"");var a=b.find(".combatant-shipname"),h=a.val(),l=b.find(".combatant-corpname"),t=l.val();b=b.find(".combatant-alliname");var u=b.val();
b.val("");l.val("");a.val("");if(h){a={shipTypeName:h,corporationName:t,allianceName:u};if(e&&a){h=$("#battlereport-"+e);if(!("brCombatantID"in a))a.brCombatantID=--p;a._team=e;n.push(a);f[a.brCombatantID]=f[a.brCombatantID]||{added:true,teamName:e,combatantInfo:a};g($(document.createElement("tr")).addClass("combatant").attr("data-combatant-id",a.brCombatantID).html('<td><img src="//image.eveonline.com/InventoryType/'+(o[a.shipTypeName]||0)+'_64.png"></td><td style="width:100%"><div class="combatant-details">'+
(a.characterName?"<strong>"+a.characterName+"</strong>":"<em>Unknown</em>")+"<br><small>"+(a.corporationName||"<em>Unknown</em>")+(!!a.allianceName>0?"<br>"+a.allianceName:"")+"</small><br>"+a.shipTypeName+"<br>&nbsp;</div></td>").appendTo(h.find("tbody")))}}});$("#save-br").click(function(){$("#battleReportChanges").val(JSON.stringify(f));$("#battleReportEditor").submit()})}})(typeof battleReport=="undefined"?null:battleReport);
(function(k,i){function n(){$(this).closest(".battle-footage-container").remove()}function j(){var g=$(".complete-battle-footage").children(".battle-footage-container"),d=$(this).closest(".battle-footage-container");g.index(d)<=0||d.insertBefore(d.prev())}function f(){var g=$(".complete-battle-footage").children(".battle-footage-container"),d=$(this).closest(".battle-footage-container");g.index(d)>=g.length-1||d.insertAfter(d.next())}function o(g){g.find("button.delete-battle-footage").click(n);g.find("button.move-battle-footage-up").click(j);
g.find("button.move-battle-footage-down").click(f);p(g)}function p(g){var d=g.find("input[name^=battleFootageCombatantCharName]"),m=g.find("input[name^=battleFootageCombatantID]");d.autocomplete({serviceUrl:"/autocomplete/combatants/"+battleReport.battleReportID,type:"POST",onSelect:function(r){m.val("");r.data?m.val(r.data):d.val("")},onInvalidateSelection:function(){m.val("")}}).blur(function(){m.val()||d.val("")})}if(typeof battleReport!="undefined"){k=$("#battle-footage-template");$(".battle-footage-container").each(function(){o($(this))});
(i=$("#add-battle-footage")).find("button.add-battle-footage").click(function(){var g=k.clone(),d=i.find("input[name^=battleFootageUrl]");g.find("input[name^=battleFootageUrl]").val(d.val());d.val("");d=i.find("input[name^=battleFootageCombatantID]");g.find("input[name^=battleFootageCombatantID]").val(d.val());d.val("");d=i.find("input[name^=battleFootageCombatantCharName]");g.find("input[name^=battleFootageCombatantCharName]").val(d.val());d.val("");i.before(g);o(g)});p(i)}})();
