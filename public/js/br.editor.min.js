(function(l,i,n,k,f,o,p){function g(h){h&&h.hover(function(){var b=$(this),a=e(b.attr("data-combatant-id"));b=b.find(".combatant-details");if(a){b.css("position","relative");k.attr("class","");a._team=="teamA"&&k.addClass("not-movable-left");a._team=="teamC"&&k.addClass("not-movable-right");a.brCombatantID<0||a.brManuallyAdded?k.addClass("not-hideable").addClass("not-showable"):k.addClass("not-trashable").addClass(a.brHidden?"not-hideable":"not-showable");if(a.died)k.addClass(a.brHidden?"not-showable":
"not-hideable");k.appendTo(b).show()}else console.log("no combatant found")},function(){k.hide()})}function e(h){if(typeof h=="undefined")return null;for(q=n.length;q--;)if((c=n[q]).brCombatantID==h)return c;return null}if(l){i=["teamA","teamB","teamC"];n=[];f={};o={};p=0;for(var m in l)if(i.indexOf(m)!=-1)for(var r=l[m],q=r.members.length,t;q--;){n.push(t=r.members[q]);t._team=m}k=$("#editor-panel").css({position:"absolute",bottom:0,right:0,width:"auto",height:"auto"});["move-left","move-right",
"show-on-br","hide-on-br","trash"].forEach(function(h){$("#editor-panel ."+h).click(function(b){b.preventDefault();b=$(this).closest(".combatant");var a=e(b.attr("data-combatant-id")),j,d;if(a)switch(h){case "move-left":j=l[a._team].members;d=i.indexOf(a._team);j.indexOf(a);j=i[(d==0?i.length:d)-1];l[a._team=j].members.push(a);b.appendTo($("#battlereport-"+j));f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].teamName=j;break;case "move-right":j=l[a._team].members;d=i.indexOf(a._team);
j.indexOf(a);j=i[(d+1==i.length?-1:d)+1];l[a._team=j].members.push(a);b.appendTo($("#battlereport-"+j));f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].teamName=j;break;case "hide-on-br":if(!a.died){a.brHidden=true;b.addClass("hidden-on-br");f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brHidden=true}break;case "show-on-br":a.brHidden=false;b.hasClass("hidden-on-br")&&b.removeClass("hidden-on-br");f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brHidden=false;
break;case "trash":a.brDeleted=true;b.detach();f[a.brCombatantID]=f[a.brCombatantID]||{};f[a.brCombatantID].brDeleted=true}})});$("*[data-combatant-id]").each(function(){g($(this))});$(".combatant-corpname").autocomplete({serviceUrl:"/autocomplete/corpNames",type:"POST",onSelect:function(h){$(this).closest(".combatant-adding-form").find(".combatant-alliname").val(h.data)}});$(".combatant-alliname").autocomplete({serviceUrl:"/autocomplete/alliNames",type:"POST"});$(".combatant-shipname").autocomplete({serviceUrl:"/autocomplete/shipNames",
type:"POST",transformResult:function(h){var b=[];if(h&&(h=$.parseJSON(h)))b=$.map(h.ships,function(a){if(!(a.name in o))o[a.name]=a.id;return{value:a.name,data:a.id}});return{suggestions:b}}});$(".combatant-adding-form").submit(function(h){h.preventDefault();var b=$(this).closest(".combatant-adding-panel");h=b.closest("table").attr("id").replace(/^battlereport-/,"");var a=b.find(".combatant-shipname"),j=a.val(),d=b.find(".combatant-corpname"),v=d.val(),s=b.find(".combatant-alliname"),w=s.val(),u=
b.find(".combatant-count");b=Math.max(parseInt(u.val()||1,10)||1,1);s.val("");d.val("");a.val("");u.val("1");if(j)for(;b--;){a=h;d={shipTypeName:j,corporationName:v,allianceName:w};if(a&&d){s=$("#battlereport-"+a);if(!("brCombatantID"in d))d.brCombatantID=--p;d._team=a;n.push(d);f[d.brCombatantID]=f[d.brCombatantID]||{added:true,teamName:a,combatantInfo:d};g($(document.createElement("tr")).addClass("combatant").attr("data-combatant-id",d.brCombatantID).html('<td><img src="//image.eveonline.com/InventoryType/'+
(o[d.shipTypeName]||0)+'_64.png"></td><td style="width:100%"><div class="combatant-details">'+(d.characterName?"<strong>"+d.characterName+"</strong>":"<em>Unknown</em>")+"<br><small>"+(d.corporationName||"<em>Unknown</em>")+(!!d.allianceName>0?"<br>"+d.allianceName:"")+"</small><br>"+d.shipTypeName+"<br>&nbsp;</div></td>").appendTo(s.find("tbody")))}}});$("#save-br").click(function(){$("#battleReportChanges").val(JSON.stringify(f));$("#battleReportEditor").submit()})}})(typeof battleReport=="undefined"?
null:battleReport);
(function(l,i){function n(){$(this).closest(".battle-footage-container").remove()}function k(){var g=$(".complete-battle-footage").children(".battle-footage-container"),e=$(this).closest(".battle-footage-container");g.index(e)<=0||e.insertBefore(e.prev())}function f(){var g=$(".complete-battle-footage").children(".battle-footage-container"),e=$(this).closest(".battle-footage-container");g.index(e)>=g.length-1||e.insertAfter(e.next())}function o(g){g.find("button.delete-battle-footage").click(n);g.find("button.move-battle-footage-up").click(k);
g.find("button.move-battle-footage-down").click(f);p(g)}function p(g){var e=g.find("input[name^=battleFootageCombatantCharName]"),m=g.find("input[name^=battleFootageCombatantID]");e.autocomplete({serviceUrl:"/autocomplete/combatants/"+battleReport.battleReportID,type:"POST",onSelect:function(r){m.val("");r.data?m.val(r.data):e.val("")},onInvalidateSelection:function(){m.val("")}}).blur(function(){m.val()||e.val("")})}if(typeof battleReport!="undefined"){l=$("#battle-footage-template");$(".battle-footage-container").each(function(){o($(this))});
(i=$("#add-battle-footage")).find("button.add-battle-footage").click(function(){var g=l.clone(),e=i.find("input[name^=battleFootageUrl]");g.find("input[name^=battleFootageUrl]").val(e.val());e.val("");e=i.find("input[name^=battleFootageCombatantID]");g.find("input[name^=battleFootageCombatantID]").val(e.val());e.val("");e=i.find("input[name^=battleFootageCombatantCharName]");g.find("input[name^=battleFootageCombatantCharName]").val(e.val());e.val("");i.before(g);o(g)});p(i)}})();
